# 白い地図

## 画面遷移図
Figma：https://www.figma.com/design/2NG3yydL45v7LcEbcWVnDs/%E7%94%BB%E9%9D%A2%E9%81%B7%E7%A7%BB%E5%9B%B3?node-id=0-1&t=SFRbcpjoe1fuacKC-1

### READMEに記載した機能
- [x] ゲスト利用機能（未ログイン状態での地図作成開始・同意画面）
- [x] 位置情報・サーバー保存に関する同意画面（ゲスト利用開始時）
- [x] 会員登録機能
- [x] ログイン機能
- [x] データの公開設定機能（デフォルト非公開・ユーザー操作による公開）
- [x] ログアウト機能
- [x] 退会（アカウント削除）機能
- [x] 地図表示機能（シンプル表示）
- [x] 位置情報取得・現在地追従機能
- [x] 霧晴れ機能（移動による可視化）
- [x] 「地図を作る」機能（記録の開始・一時停止・再開・終了）
- [x] 記録中の累計レイヤー表示機能（歩行中に過去の地図を表示する機能）
- [x] 歩行履歴の保存機能（1回分のログ保存）
- [x] 累計ログの保存機能（データの統合）
- [x] 履歴一覧閲覧機能
- [x] 履歴詳細閲覧機能（過去の「1回分の地図」の再現表示）
- [x] 履歴詳細閲覧機能（「累計地図」の表示）
- [x] 地図の公開設定変更機能（会員）
- [x] 地図のSNSシェア機能（会員）
- [x] 公開用マップの保存・発行機能（会員）
- [x] 共有URLの発行・コピー機能（会員）
- [x] OGP画像の自動生成（会員）

### 未ログイン（ゲスト・未登録）でも閲覧または利用できるページ
以下の項目は適切に未ログインでも閲覧または利用できる画面遷移になっているか？
- [x] チュートリアル・利用規約同意画面
- [x] 地図作成・記録機能（ゲスト）
- [x] 履歴閲覧機能（ゲスト）
- [x] 公開・限定公開地図の閲覧

### メールアドレス・パスワード変更確認項目
- [x] メールアドレス変更（確認メール送信→リンク踏む→完了）
- [x] パスワード再設定（リセットメール送信→再設定画面→完了）
- [x] パスワード変更（パスワード変更はメールを介さないが、パスワード変更メールを送信）

## サービス概要

一面の白い地図を、自分の足で歩いて「霧晴れ」させて自分だけの地図を作る探索アプリです。
アプリを開いて「地図を作る」ボタンを押して歩くと、その範囲が地図として記録・可視化され、世界を少しずつ開拓していく達成感を味わえます。
あえてルート案内や詳細情報を排除し、地図には道と建物の形だけを表示することで、画面への依存を減らし、目の前の街並みや道中の発見そのものを楽しむ体験を提供します。

## このサービスへの思い・作りたい理由

今って地図アプリが本当に便利ですよね。
どこに行くにも手放せない存在で、アプリに案内をしてもらわないと困ってしまい非常に依存していることを実感します。
私が普段使っている地図アプリを見ると非常に「お気に入り」の数が多く、どこへ行くにもそのお気に入りから選んだり、はたまたレビューを参考にしたりと最初から目的地が決まっています。
そして時間を無駄にしたくないとの思いから、道中もスマホの地図を見ながら一直線でただ目的地に向かうだけになっています。
後日地図を見返してみてもその目的地のことは覚えていても「道中」の記憶はあまりありません。

そんなある時、気づかされる出来事がありました。
私は彼女と一緒に目的地に向かっていました。もちろん右手には地図アプリを開いたスマホを持っています。
そんな道中で彼女は「あそこに綺麗な花がある！」「金木犀の匂いがするからどこかに金木犀があるはず！」「虹が出そうな気がする！ほら、あった！」と私が気づきもしない発見をすることが多々あったのです。
その時に私は自分の視野がすごく狭くなっているということに初めて気づいたのです。
私がただ目的地に向かう同じ道中で、彼女は色々なものを感じ、発見しているのです。
同じ道なのにこんなにも感じ方が違うのかと、彼女と私で見えている世界が違うのだと愕然とすると同時に憧れを抱いたわけです。

このアプリを作りたい理由は、そうした道中の小さな発見に気づける自分になりたいとの思いからです。
効率や時短からは一歩離れ、地図の空白を埋めていく感覚を楽しみながら、歩くこと自体を目的化するためのサービスです。
そして道中での発見や思いを写真やメモで残せるようにして感情の地図をいつでも見返せるようにし、それを共有できるようにすることで同じ場所でも人によって見方や感じ方が違うということをみんなで楽しめるようにしたいのです。

## ユーザー層について

1. 散歩や街歩きが好きで、自分の足跡を地図に残したい人
- 単なるランニングログ等とは異なり、「自分がどれだけこの街を開拓したか」を視覚的に楽しめます。歩くこと自体に「地図を完成させる」という目的意識が加わることで、散歩への達成感や満足感をより強く提供できると考えたため。

2. 旅行先で「歩いた証跡」をビジュアル重視で残したい人
- 旅行の思い出を、行った場所の「点」ではなく、歩いた「面」として記録・可視化できます。これにより「これだけ歩き回った」という深い満足感を得られると考えたためです。

3. ゲームの「マップ達成率」を埋めるのが好きな人
- 普段は「目的もなく歩く」ことをしない人でも、ゲームでマップを解放したり、未踏の地を埋めたりする感覚は直感的に楽しめます。あえて情報を削ぎ落とした「白い地図」が、その開拓欲を刺激し、歩く動機付けになると考えたため。

## サービスの利用イメージ

1. 週末、あえて目的を決めない散歩で利用する

- 利用イメージ:
  ユーザーは「今日はこの駅の周りを歩いてみよう」と決め、アプリを起動します。地図上には「すでに歩いた場所」と「まだ歩いていない白い場所（未開拓地）」が表示されます。ユーザーは、ゲームでマップの未踏エリアを埋めていく感覚で、あえて「白い場所」を選んで歩き進めます。
- 得られる価値:
  普段なら通らない路地裏や、知らなかった公園を発見するキッカケが生まれます。同じ場所の散歩でも「地図の空白を埋める」という行為によっていつもと違う景色を自然と味わえるようになります。それによって能動的に様々な場所を歩くようになり、飽きずに散歩を続ける動機付けになります。

2. 旅行先での街歩きで利用する

- 利用イメージ:
  ユーザーは、旅行先のホテルから観光地まで、あるいは気の向くままに街を探索する際にアプリを起動しっぱなしにします。探索を終えてホテルに戻った後、アプリの「履歴」を開き、その日歩いた軌跡を眺めます。
  （将来、写真・メモ機能が追加されたら）ユーザーは、旅行中に見つけた絶景スポットや、印象的だった場所で、その写真と感想を地図上にピン留めしていきます。
- 得られる価値:
  MVPの時点では、自分がその日どれだけの範囲を歩き回ったかが「面」として可視化され、「これだけ歩き回った」という強い達成感と満足感を得られます。
  将来的には、その「軌跡」に「写真」や「思い出のメモ」が紐づくことで、旅行の思い出が詰まった「自分だけのオリジナル旅行マップ」が完成します。それを見返したり、友人に「こんなところを歩いたよ」と共有したりする楽しみが生まれます。

3. 商店街での食べ歩きや、路地裏のカフェ巡りで利用する

- 利用イメージ:
  ユーザーは、食べ歩きやカフェ巡りを楽しむ際にアプリを起動します。「白い場所」を意識して進むことで、ガイドブックには載っていないローカルなお店や、普段は入らない路地裏に自然と足が向かいます。
  （将来、写真・メモ機能が追加されたら）ユーザーは、道中で食べたものや、雰囲気の良いカフェを見つけた場所で、その写真と「美味しかった！」という感想を地図上にピン留めしていきます。
- 得られる価値:
  MVPの時点では、歩いた「軌跡」が残ることで「このエリアを制覇した」という達成感が得られます。
  将来的には、その軌跡に「味の記憶」や「感情」が紐づくことで、自分だけのオリジナルな「食べ歩きグルメマップ」が完成し、それを見返したり友人と共有したりする楽しみが生まれます。

4. 「いつもの場所」へ、あえて違う道を通って向かう

- 利用イメージ:
  ユーザーは、例えば「最寄駅」や「よく行くカフェ」を目的地として設定します。ただし、アプリは道順（ルート）を表示しません。地図上には「目的地のピン」と「未開拓の白い場所」だけが表示されます。
  ユーザーは、そのピンの方角へ向かいながら、いつも通る最短ルートを避け、あえて「白い場所」を埋めるように道を選びます。
- 得られる価値:
  いつもと同じ目的地へ向かうだけの「退屈な移動」が、「新しい道を開拓する」という日々の小さな楽しみ（ゲームのような）に変わります。
  最短ルートでは出会えなかった景色、気付かなかったお店を発見でき、「道中の小さな発見」をするキッカケを、サービスが能動的に作り出します。

## ユーザーの獲得について

1. 「試す」までのハードルを極限まで下げる
- いきなり会員登録を求めるのではなく、未ログイン（ゲスト）状態でも「地図を作る」機能をすぐに試せるように。
- 「アプリを開く→歩く→霧が晴れる」というコア体験をまず味わってもらい、その記録を保存・管理したくなったタイミングで会員登録をしてもらうようにし、お手軽に触れるように。

2. OGP画像による拡散
- マップ作成後、結果ページのURLをワンタップでX等へシェアできる機能を実装。
- その際、単なる文字リンクではなく、OGP画像として「ユーザーが作った地図」が表示されるように。
- タイムライン上で地図の画像が目を引き、「これは何？」と興味をひかせてリンクをクリックしてくれるように。

3. 地域タグと専用タグによってSNS上でも検索をしやすいように設計
- ユーザーがSNSに投稿をする際、汎用的なタグ（#散歩）に頼るのではなく、位置情報から逆算した「具体的な地名タグ（例：#埼玉県 #さいたま市 #大宮区）」と、アプリ固有の「#白い地図」を自動で入力候補に入れる。
- 地名タグで「自分の知っている場所」や「気になる場所」の地図だとわかり、「こんな場所があるんだ」「人から見るとこんな風に見えるんだ」「自分もやってみたい」という関心を引き寄せる。
- 「#白い地図」という現在未使用のタグを使用し、このタグと地名タグでアプリ上ではなくSNS上でも気軽に検索できるように。

## サービスの差別化ポイント・推しポイント
---
1. 競合サービスとの差別化

- Fog of World (類似アプリ) との違い:
  - 体験の「主目的」の違い (ゲーム攻略 vs 現実の発見):
    - 「Fog of World」という類似アプリは、レビューで「レベル453」「レベル70」といった「レベルアップ」や「市内の全ての道を制覇」「マップを埋める」といった「攻略（制覇）」が、楽しさの主軸になっていることが分かります。
    - 本サービスでは、MVP（最小構成）の段階ではあえてレベルや実績といったゲーム要素を排除し、主目的をあくまでもその場面での自分の地図を作ること、つまりアプリを見ながら行ったことのない場所へ行き「現実世界での道中の発見」をアプリに記録・共有することに置いています。アプリは使用しますがあくまでも現実世界での発見を楽しむことが目的です。

  - 「霧」の設計思想の違い (情報あり vs 情報なし):
    - 「Fog of World」は「うっすら元の地図が見える」仕様です。本サービスはそれとは違い自分の周り以外は何も見えない「完全な白地図」となっています。地図上の表示も道や建物の形が分かるぐらいで、そこに何があるのか目で見て確かめないとわからないようにします。情報をあえて無くすことで目の前の風景に集中しやすくしたり、知らない場所を開拓していく感覚や、自分で地図を作り上げていくという感覚が強くなります。

- Google タイムラインとの違い:
  - タイムラインは「個人の軌跡の自動記録」が主目的ですが、本サービスは「地図を開拓し、新たな発見をする」という能動的な体験と達成感を主軸としています。

2. 本サービスの推しポイント

  - 「道中」に意識を切り替えるデザイン:
    - あえて店舗情報やルート案内を一切排除し、最初は白で覆われた何も見えない地図が、自分の軌跡（歩いた範囲）によって“霧が晴れる”ように可視化されていきます。これにより、ユーザーの意識が「目的地」や「アプリ上のお店」ではなく「今歩いている道」や「目的地までどのようなルートで行くのか」現実と向き合うように設計します。これがMVP時点での推しポイントです。そして将来的には、その道中での「発見」を記録・共有できるように、写真・メモ機能を追加し、自分だけの「感情の地図」を作るサービスへと発展させていきます。

## 機能候補

### MVP

1. ユーザー認証・アカウント機能
- ゲスト利用機能（登録なしで地図作成を試せる・ブラウザ保存など）
- 会員登録・ログイン機能（データ保存・復元用）
  - プライバシー対応: アカウント作成時及びゲスト利用開始時に、位置情報の取得・サーバー保存に関する同意画面を表示。
  - データ公開設定: 保存された地図データはデフォルトでは非公開。ユーザーが意図して操作しない限り公開されない。
- ログアウト・退会機能

2. 地図・探索機能
- 地図表示機能（MapLibreを使用し、余計な情報を削ぎ落としたシンプル表示）
- 位置情報取得機能（GPSによる現在地追従）
- 霧晴れ機能（地図全体を白くフィルターをかけ、現在地周辺のセルをリアルタイムで透過して地図を可視化していく）
- 「地図を作る」機能（歩行記録の開始・停止・一時停止）
  - 累計レイヤー表示: 歩行中、過去の「累計地図（今まで歩いた全ての範囲）」を表示し、未開拓地を分かりやすくする。

3. データの保存・管理機能
- 歩行履歴のDB保存機能
  - 1回分のログ保存: 開始から停止まで（1セッション）の歩いた範囲の保存
  - 累計のログ保存: 過去に歩いた全ての範囲を統合したデータの保存
- 履歴閲覧機能（復元表示）
  - 過去の「1回分の地図」または「累計地図」を選択し、地図上に再現して閲覧できる機能（※閲覧モードのため、ここからの追記は不可）

4. シェア・拡散機能
- 作成した地図のSNS共有機能（スナップショット共有）
  - ユーザーが「シェア」ボタンを押した時点の地図データを「公開用マップ」として保存・発行する機能。
  - 発行されたURLは未ログインユーザー（ゲスト）でも閲覧可能。
  - プライバシー保護のため、デフォルトは非公開とし、意図的な操作でのみ公開される仕様とする。
  - OGP画像の自動生成（シェア用のURLに対し、霧晴れ状態の地図画像をカードとして表示し、SNSでの視認性を高める）

### 本リリース

1. 感情の地図機能
- 写真・メモの投稿機能（発見やその時の思いを記録する）
- 写真・メモの投稿位置の選択機能（以下の3パターンを実装）
  1. 現在地に投稿: 歩いているその場所でピンを立てる(現在地の緯度経度をMapLibre上の座標から取得して画像と共にDBに保存)
  2. 写真の位置情報通りに投稿: 撮影済みの写真からExif情報を読み取り、その地点にピンを立てる(exifrを使用して実装予定)
  3. ユーザーが位置を決めて投稿: 地図上を長押し等して、任意の位置にピンを立てる(地図上の緯度経度をMapLibre上の座標から取得して画像と共にDBに保存)

2. 探索サポート機能
- 目的地表示機能（ルートなしナビ）
  - 目的地を検索・設定する機能(Geoapifyを使用し、施設や地名による検索を実装予定)
  - ルートは表示せず、「目的地のピン」と「現在地からの直線距離・方角」のみを表示するコンパスのようなUI(geolibを使用して実装予定)

3. データ管理・編集機能
- 期間指定フィルター機能
  - 「1月1日〜1月31日」のように期間を指定して、その間に歩いた範囲だけを結合した累計地図を表示する機能
- 地図の結合機能
  - 複数回の記録を一つにまとめる機能（例：1泊2日の旅行で分かれてしまった記録を結合し、一つの「旅行記」として共有可能にする）
- 地図の修正機能
  - GPSの誤差で建物にめり込んだり、海の上を歩いたりしてしまった軌跡を手動で消去・修正する機能

4. その他
- フォロー・フォロワー機能
- 「いいね」機能（他人の地図や発見に対してリアクション）
- プライバシーエリア設定（自宅周辺など、記録・公開したくない範囲をマスクする機能）
- プロフィール編集機能（ユーザー名・アイコン・自己紹介）
- Google認証ログイン
- 公開地図の表示・検索機能
  - 他のユーザーが「シェア（公開）」設定にした地図を、タイムライン形式やエリア検索で閲覧できる機能。
  - URLを知っている人だけからアプリ内で誰でも探せるように。
- 実績・バッジ機能（例：「〇〇区を10%開放」など）

## 機能の実装方針

- Ruby on Rails 7.2.1
- PostgreSQL
- Render
- Tailwind CSS
- Stimulus
- MapLibre GL JS(地図描画)
- MapTiler(地図タイルデータ)
- Geoapify (目的地検索)
- ngeohash(Geohash計算)
- geolib(距離・方角計算)
- exifr(写真Exif情報の解析)
- Devise(ユーザー認証)
